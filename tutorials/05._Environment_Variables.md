# Environment variables

As you were instructed to in the README.md, you should have created a `env` file for the dev setup. 

However, if you look in `src/backend/.dockerignore`, you will see that it contains `.env`. This means that when when an image is build, the `.env` file will not be included.

This is a good practice and allows us to make the image public without worrying about leaking sensitive information.

## Accessing the value on the server

One the server the following section has been added:

```python
################################################################################ 
# Environment Variables
################################################################################

from dotenv import load_dotenv

load_dotenv()

@app.route('/greeting')
def home():
    return os.getenv('GREETING')
```

The dotenv package has been added to requirements.txt and it loads the values from the `.env` file. The greeting defined in the `.env` file will be returned when the `/greeting` endpoint is hit.

## Production 

This is a setup to show one possible way to handle environment variables production. 

In the continuous deployment branch the workflow file will contain the following:

```yaml
      - name: Create .env file
        run: |
          echo "GREETING=${{ secrets.ENV_GREETING }}" >> .env

      - name: Transfer .env file to server
        run: |
          scp -i ~/.ssh/ssh_key -o StrictHostKeyChecking=no .env $SSH_USER@$SSH_HOST:.env
        env:
          SSH_USER: ${{ secrets.SSH_USER }}
          SSH_HOST: ${{ secrets.SSH_HOST }}
```

It creates the `.env` file with the environment variable `GREETING` on the runner and then transfers the file to the server.

By adding echo statements you can add more environment variables to the `.env` file.

Once you have the `.env` file on the server, you use the `--env-file` flag when running the container to load the environment variables:

```bash
$ docker run -d --env-file .env --network my_network -p 8080:8080 --name whoknows_variations_server ghcr.io/who-knows-inc/whoknows_variations_server
```